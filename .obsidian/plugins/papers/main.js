/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var k=Object.create;var w=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var X=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var z=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports),Y=(i,s)=>{for(var t in s)w(i,t,{get:s[t],enumerable:!0})},U=(i,s,t,e)=>{if(s&&typeof s=="object"||typeof s=="function")for(let r of X(s))!j.call(i,r)&&r!==t&&w(i,r,{get:()=>s[r],enumerable:!(e=L(s,r))||e.enumerable});return i};var H=(i,s,t)=>(t=i!=null?k(_(i)):{},U(s||!i||!i.__esModule?w(t,"default",{value:i,enumerable:!0}):t,i)),V=i=>U(w({},"__esModule",{value:!0}),i);var O=z(m=>{"use strict";Object.defineProperty(m,"__esModule",{value:!0});m.stringSimilarity=void 0;var W=function(i,s,t,e){if(t===void 0&&(t=2),e===void 0&&(e=!1),e||(i=i.toLowerCase(),s=s.toLowerCase()),i.length<t||s.length<t)return 0;for(var r=new Map,a=0;a<i.length-(t-1);a++){var o=i.substr(a,t);r.set(o,r.has(o)?r.get(o)+1:1)}for(var l=0,h=0;h<s.length-(t-1);h++){var p=s.substr(h,t),c=r.has(p)?r.get(p):0;c>0&&(r.set(p,c-1),l++)}return l*2/(i.length+s.length-(t-1)*2)};m.stringSimilarity=W;m.default=m.stringSimilarity});var G={};Y(G,{default:()=>E});module.exports=V(G);var n=require("obsidian"),y=H(O()),v={notesFolder:"",pdfFolder:"",noteTemplate:`---
title: "{{TITLE}}"
authors:
{{AUTHORS}}
year: {{YEAR}}
url: {{URL}}
---
![[{{PDF}}]]`},f=i=>i.toLowerCase().replace(/[-:,.]/g," ").replace(/\s+/g," ").trim(),x=i=>{let s=i.match(/arxiv\.org\/(abs|pdf|html)\/(\d{4}\.\d{4,5})(v\d+)?/);return s?s[2]:null},E=class extends n.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"import",name:"Import",callback:()=>this.showImportModal()}),this.addCommand({id:"import-from-clipboard",name:"Import from clipboard",callback:()=>this.createNoteFromClipboard()}),this.addSettingTab(new C(this.app,this))}showImportModal(){new F(this.app,async t=>{t&&(t.isArxivUrl?await this.processArxivUrl(t.input):await this.createNoteFromMetadata(t))}).open()}async processArxivUrl(t){let e=x(t);if(!e){new n.Notice("Invalid arXiv URL.");return}let r=new n.Notice("Fetching paper metadata from arXiv...",0);try{let a=await this.fetchArxivMetadata(e);if(r.hide(),!a){new n.Notice("Could not find metadata for the arXiv paper.");return}await this.createNoteFromMetadata(a)}catch(a){r.hide(),new n.Notice("Failed to fetch paper metadata."),console.error("Metadata fetch error:",a)}}async createNoteFromClipboard(){let t=await navigator.clipboard.readText();if(!(t!=null&&t.trim())){new n.Notice("Clipboard is empty.");return}if(x(t)){await this.processArxivUrl(t.trim());return}let e=new F(this.app,async r=>{r&&(r.isArxivUrl?await this.processArxivUrl(r.input):await this.createNoteFromMetadata(r))});e.currentInput=t.trim(),e.onOpen=function(){n.SuggestModal.prototype.onOpen.call(this),setTimeout(()=>{this.inputEl&&(this.inputEl.value=t.trim(),this.inputEl.focus(),this.performSearch())},10)},e.open()}async createNoteFromMetadata(t){var p;let e=this.sanitizeFileName(t.title)+".md",a=((p=this.settings.notesFolder)!=null&&p.trim()?this.settings.notesFolder.trim().replace(/\/$/,"")+"/":"")+e,o=await this.app.vault.adapter.exists(a);if(o&&!await this.confirmOverwrite())return;let l="";if(this.settings.noteTemplate.includes("{{PDF}}")&&t.url.includes("arxiv.org"))try{l=await this.downloadPdf(t)}catch(c){new n.Notice(`PDF download failed: ${c.message}`),console.error("PDF download error:",c)}let h=this.formatNoteContent(t,l);try{if(o){let d=await this.app.vault.getAbstractFileByPath(a);d instanceof n.TFile&&await this.app.vault.modify(d,h)}else await this.app.vault.create(a,h);new n.Notice("Created paper note: "+e);let c=await this.app.vault.getAbstractFileByPath(a);c instanceof n.TFile&&await this.app.workspace.getLeaf(!0).openFile(c)}catch(c){new n.Notice("Error creating note: "+c)}}async downloadPdf(t){var h;let e=x(t.url);if(!e)throw new Error("Could not extract arXiv ID from URL");let r=this.sanitizeFileName(t.title)+".pdf",a=(h=this.settings.pdfFolder)!=null&&h.trim()?this.settings.pdfFolder.trim().replace(/\/$/,"")+"/":"";if(a&&!await this.app.vault.adapter.exists(a.slice(0,-1)))throw new Error(`PDF folder "${this.settings.pdfFolder}" doesn't exist. Please create it first.`);let o=a+r;if(await this.app.vault.adapter.exists(o))return r;let l=new n.Notice("",0);try{let p=`https://arxiv.org/pdf/${e}.pdf`;l.setMessage(`Downloading PDF for "${t.title}"...`);let c=await(0,n.requestUrl)(p);if(!c.arrayBuffer)throw new Error("Failed to download PDF content");let d=new Uint8Array(c.arrayBuffer);return await this.app.vault.adapter.writeBinary(o,d),l.hide(),r}catch(p){throw l.setMessage(`Failed to download PDF for "${t.title}"`),setTimeout(()=>l.hide(),5e3),new Error(`Failed to download PDF: ${p.message}`)}}async fetchArxivMetadata(t){var e,r,a;try{let l=(await(0,n.requestUrl)(`https://export.arxiv.org/api/query?id_list=${t}`)).text,c=new DOMParser().parseFromString(l,"application/xml").querySelector("entry");if(!c)return null;let d=((r=(e=c.querySelector("title"))==null?void 0:e.textContent)==null?void 0:r.trim().replace(/\s+/g," "))||"",g=Array.from(c.querySelectorAll("author > name")).map(P=>P.textContent||""),u=((a=c.querySelector("published"))==null?void 0:a.textContent)||"",S=new Date(u).getFullYear();return{title:d,authors:g,year:S,url:`https://arxiv.org/abs/${t}`}}catch(o){return console.error("Failed to fetch arXiv metadata:",o),null}}sanitizeFileName(t){return t.replace(/:/g," - ").replace(/[\\/:*?"<>|]/g,"").replace(/\s{2,}/g," ").trim()}formatNoteContent(t,e=""){let r=this.settings.noteTemplate,a=t.authors.map(o=>`  - ${o}`).join(`
`);return r.replace(/\{\{TITLE\}\}/g,this.sanitizeFileName(t.title)).replace(/\{\{URL\}\}/g,t.url).replace(/\{\{YEAR\}\}/g,t.year.toString()).replace(/\{\{AUTHORS\}\}/g,a).replace(/\{\{PDF\}\}/g,e)}confirmOverwrite(){return new Promise(t=>{new T(this.app,t).open()})}async loadSettings(){this.settings=Object.assign({},v,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},F=class extends n.SuggestModal{constructor(t,e){super(t);this.choices=[];this.loading=!1;this.hasSearched=!1;this.currentInput="";this.onChoice=e,this.setPlaceholder("Search paper title or arXiv URL...")}onOpen(){super.onOpen(),this.resultContainerEl&&this.resultContainerEl.hide(),setTimeout(()=>{this.inputEl&&(this.inputEl.focus(),this.inputEl.addEventListener("keyup",t=>{t.key==="Enter"&&!this.hasSearched&&!this.loading&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),this.performSearch())}))},10)}getSuggestions(t){if(this.currentInput=t,this.loading||!this.hasSearched||!this.choices.length)return[];let e=f(t);return this.choices.filter(r=>(0,y.default)(f(r.title),e)>.3).sort((r,a)=>{let o=(0,y.default)(f(r.title),e);return(0,y.default)(f(a.title),e)-o})}renderSuggestion(t,e){var r;e.createEl("div",{text:t.title}),(r=t.authors)!=null&&r.length&&e.createEl("small",{text:t.authors.join(", ")})}onChooseSuggestion(t){this.onChoice(t)}manualRefresh(){setTimeout(()=>{this.inputEl&&this.inputEl.dispatchEvent(new Event("input",{bubbles:!0}))},0)}async performSearch(){var e,r;let t=((r=(e=this.inputEl)==null?void 0:e.value)==null?void 0:r.trim())||this.currentInput.trim();if(t){if(x(t)){this.close(),this.onChoice({isArxivUrl:!0,input:t});return}this.setLoading(!0);try{let a=await this.searchArxivByTitle(t);this.setSearchResults(a)}catch(a){console.error("Search failed:",a),this.setSearchResults([]),this.emptyStateText="Search failed. Please try again.",this.loading=!1,this.hasSearched=!0,this.inputEl&&(this.inputEl.disabled=!1),this.manualRefresh()}}}setLoading(t){this.loading=t,this.inputEl&&(this.inputEl.disabled=t),t&&(this.emptyStateText="Searching arXiv...",this.hasSearched=!0,this.resultContainerEl&&this.resultContainerEl.show()),this.manualRefresh()}setSearchResults(t){this.loading=!1,this.hasSearched=!0,this.choices=t,this.resultContainerEl&&this.resultContainerEl.show(),this.emptyStateText=t.length===0?"No results found":"No matching results",this.inputEl&&(this.inputEl.disabled=!1),this.manualRefresh()}async searchArxivByTitle(t,e=3){let o=`https://export.arxiv.org/api/query?search_query=ti:"${f(t).split(" ").map(l=>encodeURIComponent(l)).join("+")}"&start=0&max_results=10`;for(let l=1;l<=e;l++)try{let p=(await(0,n.requestUrl)(o)).text,d=new DOMParser().parseFromString(p,"application/xml");return Array.from(d.querySelectorAll("entry")).map(u=>{var A,D,M,b,N,R;let S=((D=(A=u.querySelector("title"))==null?void 0:A.textContent)==null?void 0:D.trim().replace(/\s+/g," "))||"",P=Array.from(u.querySelectorAll("author > name")).map(B=>B.textContent||""),I=((M=u.querySelector("published"))==null?void 0:M.textContent)||"",$=new Date(I).getFullYear(),q=((R=(N=(b=u.querySelector("id"))==null?void 0:b.textContent)==null?void 0:N.match(/\d{4}\.\d{4,5}/))==null?void 0:R[0])||"";return{title:S,authors:P,year:$,url:`https://arxiv.org/abs/${q}`}})}catch(h){console.warn(`ArXiv search attempt ${l}/${e} failed:`,h);let p=h.message;if(!(p.includes("ERR_CONNECTION_RESET")||p.includes("ERR_NETWORK")||p.includes("request"))||l===e)throw h;let d=Math.pow(2,l-1)*1e3;await new Promise(g=>setTimeout(g,d)),this.emptyStateText=`Searching arXiv... (retry ${l+1}/${e})`,this.manualRefresh()}return[]}onCancel(){this.onChoice(null)}},T=class extends n.Modal{constructor(t,e){super(t);this.onDecision=e}onOpen(){let{contentEl:t,titleEl:e}=this;e.setText("File exists"),t.empty(),t.createEl("p",{text:"A note with this title already exists. Do you want to overwrite?"});let r=t.createDiv({cls:"modal-button-container"});Object.assign(r.style,{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"30px"});let a=r.createEl("button",{text:"Overwrite",cls:"mod-warning"});a.onclick=()=>{this.close(),this.onDecision(!0)};let o=r.createEl("button",{text:"Cancel"});o.onclick=()=>{this.close(),this.onDecision(!1)}}onClose(){this.contentEl.empty()}},C=class extends n.PluginSettingTab{constructor(t,e){super(t,e);this.plugin=e}display(){let{containerEl:t}=this;t.empty(),new n.Setting(t).setName("Notes folder").setDesc("Folder to save paper notes.").addText(a=>a.setPlaceholder("Example: Research/Papers").setValue(this.plugin.settings.notesFolder).onChange(async o=>{this.plugin.settings.notesFolder=o,await this.plugin.saveSettings()})),new n.Setting(t).setName("PDF folder").setDesc("Folder to save PDFs. These are only downloaded if notes contain the {{PDF}} placeholder.").addText(a=>a.setPlaceholder("Example: Research/PDF").setValue(this.plugin.settings.pdfFolder).onChange(async o=>{this.plugin.settings.pdfFolder=o,await this.plugin.saveSettings()}));let e=new n.Setting(t).setName("Note template").setDesc("Template for creating paper notes. Use {{TITLE}}, {{AUTHORS}}, {{YEAR}}, {{URL}}, and {{PDF}} to insert metadata.").addTextArea(a=>{a.setPlaceholder(v.noteTemplate).setValue(this.plugin.settings.noteTemplate||v.noteTemplate).onChange(async o=>{this.plugin.settings.noteTemplate=o||v.noteTemplate,await this.plugin.saveSettings()}),a.inputEl.rows=10,Object.assign(a.inputEl.style,{width:"100%",minWidth:"100%"})});Object.assign(e.settingEl.style,{display:"block"});let r=e.settingEl.querySelector(".setting-item-control");r&&Object.assign(r.style,{marginTop:"10px"})}};

/* nosourcemap */